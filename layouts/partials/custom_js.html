<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.querySelector('.js-theme-toggle');
    const linkLight = document.querySelector('.js-set-theme-light');
    const linkDark = document.querySelector('.js-set-theme-dark');

    if (!toggleButton || !linkLight || !linkDark) {
      return;
    }

    function isDarkMode() {
      if (typeof window === 'undefined') {
        return false;
      }
      const stored = localStorage.getItem('wcTheme');
      if (stored === '1') {
        return true;
      }
      if (stored === '0') {
        return false;
      }
      return document.body.classList.contains('dark');
    }

    function updateToggleState(dark) {
      toggleButton.setAttribute('aria-pressed', dark ? 'true' : 'false');
      toggleButton.dataset.theme = dark ? 'dark' : 'light';
    }

    toggleButton.addEventListener('click', function (event) {
      event.preventDefault();
      const dark = isDarkMode();
      if (dark) {
        linkLight.click();
      } else {
        linkDark.click();
      }
    });

    document.addEventListener('wcThemeChange', function (event) {
      const resolver = event.detail && event.detail.isDarkTheme;
      const dark = typeof resolver === 'function' ? resolver() : document.body.classList.contains('dark');
      updateToggleState(dark);
    });

    updateToggleState(isDarkMode());
  });
</script>
